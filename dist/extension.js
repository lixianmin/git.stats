(()=>{"use strict";var t={144:function(t,n,e){var a,o=this&&this.__createBinding||(Object.create?function(t,n,e,a){void 0===a&&(a=e);var o=Object.getOwnPropertyDescriptor(n,e);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[e]}}),Object.defineProperty(t,a,o)}:function(t,n,e,a){void 0===a&&(a=e),t[a]=n[e]}),i=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),s=this&&this.__importStar||(a=function(t){return a=Object.getOwnPropertyNames||function(t){var n=[];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[n.length]=e);return n},a(t)},function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e=a(t),s=0;s<e.length;s++)"default"!==e[s]&&o(n,t,e[s]);return i(n,t),n});Object.defineProperty(n,"__esModule",{value:!0}),n.activate=function(t){const n=r.window.createStatusBarItem(r.StatusBarAlignment.Right,1e3);n.text="$(graph-line) Git Stats",n.tooltip="Click to view your Git contribution statistics",n.command="git-stats.showStats";const e=()=>{r.workspace.workspaceFolders?n.show():n.hide()};e(),t.subscriptions.push(r.workspace.onDidChangeWorkspaceFolders((()=>e()))),t.subscriptions.push(n);let a=r.commands.registerCommand("git-stats.showStats",(async()=>{const n=r.workspace.workspaceFolders;if(!n)return void r.window.showErrorMessage("Please open a workspace with a Git repository");const e=n[0].uri.fsPath,a=(0,l.simpleGit)(e);try{if(!await a.checkIsRepo())return void r.window.showErrorMessage("This workspace is not a Git repository");const n=new c.GitContributionAnalyzer(a),e=new d.ContributionVisualization(t,n);r.window.withProgress({location:r.ProgressLocation.Notification,title:"Analyzing Git history...",cancellable:!1},(async t=>{const a=await n.getContributionStats();await e.show(a)})),e.onTimeRangeChange((async(t,a,o)=>{r.window.withProgress({location:r.ProgressLocation.Notification,title:"Updating statistics...",cancellable:!1},(async()=>{const i=await n.getContributionStats(t,a,o);await e.updateStats(i)}))}))}catch(t){r.window.showErrorMessage("Error analyzing Git history: "+t)}}));t.subscriptions.push(a)};const r=s(e(398)),l=e(807),c=e(879),d=e(985)},879:function(t,n,e){var a,o=this&&this.__createBinding||(Object.create?function(t,n,e,a){void 0===a&&(a=e);var o=Object.getOwnPropertyDescriptor(n,e);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[e]}}),Object.defineProperty(t,a,o)}:function(t,n,e,a){void 0===a&&(a=e),t[a]=n[e]}),i=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),s=this&&this.__importStar||(a=function(t){return a=Object.getOwnPropertyNames||function(t){var n=[];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[n.length]=e);return n},a(t)},function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e=a(t),s=0;s<e.length;s++)"default"!==e[s]&&o(n,t,e[s]);return i(n,t),n}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.GitContributionAnalyzer=void 0;const l=r(e(807)),c=r(e(716)),d=s(e(383)),u=s(e(3));n.GitContributionAnalyzer=class{constructor(t,n={}){this.repoPath="",this.git=t,this.config={excludePatterns:["**/*.pb.go","**/*.pb.js","**/*.pb.ts","**/*_pb2.py","**/*_pb3.py","**/generated/**","**/*.pb.cs",...n.excludePatterns||[]]}}isProtobufGeneratedFile(t){if(t.includes("Protos/")||t.includes("Protos\\")){if(t.toLowerCase().endsWith(".cs"))try{d.readFileSync(t,"utf8").split("\n").slice(0,5).join("\n");return!0}catch(t){return!0}return!0}if(!d.existsSync(t))return!1;if(t.toLowerCase().endsWith(".cs"))try{const n=d.readFileSync(t,"utf8").split("\n").slice(0,20).join("\n"),e=["Generated by the protocol buffer compiler","<auto-generated>","DO NOT EDIT","using pb = global::Google.Protobuf","using pbc = global::Google.Protobuf.Collections","namespace Google.Protobuf","#pragma warning disable"].some((t=>n.includes(t)));return e}catch(t){return!1}return this.config.excludePatterns.some((n=>{const e=n.replace(/\./g,"\\.").replace(/\*\*/g,".*").replace(/\*/g,"[^/]*"),a=new RegExp(e).test(t);return a}))}shouldIncludeFile(t){if(t.includes("Protos/")||t.includes("Protos\\"))return!1;const n=u.join(this.repoPath,t),e=this.isProtobufGeneratedFile(n);return!e}async getLastCommitTime(){try{const t=await this.git.log(["-1","--pretty=format:%aI"]);if(t&&t.latest&&t.latest.hash){const n=t.latest.hash.trim(),e=(0,c.default)(n);if(e.isValid())return e}}catch(t){}return(0,c.default)()}async getContributionStats(t=7,n,e){let a,o;n&&e?(o=(0,c.default)(n).startOf("day"),a=(0,c.default)(e).endOf("day")):(a=await this.getLastCommitTime(),a.isValid()||(a=(0,c.default)()),o=a.clone().subtract(t-1,"days").startOf("day"),a=a.clone().endOf("day"));try{const t=await this.git.log(["--all","--no-merges","--numstat","--date=iso-strict","--pretty=format:commit %H%n%an%n%aI%n%s%n","--since",o.format("YYYY-MM-DD HH:mm:ss"),"--until",a.format("YYYY-MM-DD HH:mm:ss"),"--invert-grep","--grep=^WIP","--grep=^stash","--grep=^\\[STASH\\]","--grep=^\\[stash\\]"]);if(!t||!t.all||0===t.all.length)return{};const n={},e=t.all[0].hash.split("\ncommit ");for(const t of e){if(!t.trim())continue;const e=t.split("\n");if(e.length<4)continue;e[0].trim();const i=e[1].trim(),s=e[2].trim(),r=e[3].trim();if(i.toLowerCase().includes("stash")||r.toLowerCase().includes("stash")||r.startsWith("WIP")||r.startsWith("[STASH]")||r.startsWith("[stash]"))continue;const l=(0,c.default)(s);if(!l.isValid())continue;n[i]||(n[i]={author:i,email:"",startDate:o,endDate:a,totalCommits:0,totalInsertions:0,totalDeletions:0,totalFiles:0,dailyStats:{}});const d=l.format("YYYY-MM-DD");n[i].dailyStats[d]||(n[i].dailyStats[d]={commits:0,insertions:0,deletions:0,files:0}),n[i].totalCommits++,n[i].dailyStats[d].commits++;for(let t=4;t<e.length;t++){const a=e[t].trim();if(!a)continue;const[o,s,r]=a.split("\t");if(!r)continue;if(!this.shouldIncludeFile(r))continue;const l="-"===o?0:parseInt(o)||0,c="-"===s?0:parseInt(s)||0;n[i].totalInsertions+=l,n[i].totalDeletions+=c,n[i].totalFiles++,n[i].dailyStats[d].insertions+=l,n[i].dailyStats[d].deletions+=c,n[i].dailyStats[d].files++}}return n}catch(t){throw t}}async analyzeRepository(t,n,e){this.repoPath=t;const a=(0,l.default)(t),o={};try{const t=(await a.raw(["log","--all","--no-merges","--numstat","--format=commit:%H%nauthor:%aN%nemail:%aE%ndate:%aI"])).split("\ncommit:").filter((t=>t.trim()));for(const a of t){const t=a.trim().split("\n");let i="",s="",r="",l=0,d=0,u=0;for(const n of t)if(n.startsWith("author:"))i=n.substring(7).trim();else if(n.startsWith("email:"))s=n.substring(6).trim();else if(n.startsWith("date:"))r=n.substring(5).trim();else if(n.trim()&&!n.startsWith("commit:")){const t=n.split("\t");if(3===t.length){const[n,e]=t,a=parseInt(n)||0,o=parseInt(e)||0;l+=a,d+=o,u++}}const h=(0,c.default)(r);if(!h.isValid())continue;if(h.isBefore(n)||h.isAfter(e))continue;o[i]||(o[i]={author:i,email:s,startDate:n,endDate:e,totalCommits:0,totalInsertions:0,totalDeletions:0,totalFiles:0,dailyStats:{}}),o[i].dailyStats[h.format("YYYY-MM-DD")]||(o[i].dailyStats[h.format("YYYY-MM-DD")]={commits:0,insertions:0,deletions:0,files:0});const m=l,p=d,g=u;o[i].totalCommits++,o[i].totalInsertions+=m,o[i].totalDeletions+=p,o[i].totalFiles+=g,o[i].dailyStats[h.format("YYYY-MM-DD")].commits++,o[i].dailyStats[h.format("YYYY-MM-DD")].insertions+=m,o[i].dailyStats[h.format("YYYY-MM-DD")].deletions+=p,o[i].dailyStats[h.format("YYYY-MM-DD")].files+=g}return o}catch(t){throw t}}processCommitStats(t,n,e,a,o){const{hash:i,author:s,email:r,date:l}=t,d=l.clone().startOf("day"),u=c.default.utc(a).startOf("day"),h=c.default.utc(o).endOf("day");if(d.isBefore(u)||d.isAfter(h))return;const m=l.format("YYYY-MM-DD");e[s]||(e[s]={author:s,email:r,startDate:a,endDate:o,totalCommits:0,totalInsertions:0,totalDeletions:0,totalFiles:0,dailyStats:{}}),e[s].dailyStats[m]||(e[s].dailyStats[m]={commits:0,insertions:0,deletions:0,files:0});const p=n.insertions.reduce(((t,n)=>t+n),0),g=n.deletions.reduce(((t,n)=>t+n),0),f=n.insertions.length;e[s].totalCommits++,e[s].totalInsertions+=p,e[s].totalDeletions+=g,e[s].totalFiles+=f,e[s].dailyStats[m].commits++,e[s].dailyStats[m].insertions+=p,e[s].dailyStats[m].deletions+=g,e[s].dailyStats[m].files+=f}parseNumstat(t){const n=t.split("\n");let e=0,a=0,o=0;for(const t of n){if(!t.trim())continue;const[n,i]=t.split("\t");n&&i&&(e+="-"===n?0:parseInt(n,10)||0,a+="-"===i?0:parseInt(i,10)||0,o++)}return{insertions:e,deletions:a,files:o}}}},985:function(t,n,e){var a,o=this&&this.__createBinding||(Object.create?function(t,n,e,a){void 0===a&&(a=e);var o=Object.getOwnPropertyDescriptor(n,e);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[e]}}),Object.defineProperty(t,a,o)}:function(t,n,e,a){void 0===a&&(a=e),t[a]=n[e]}),i=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),s=this&&this.__importStar||(a=function(t){return a=Object.getOwnPropertyNames||function(t){var n=[];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[n.length]=e);return n},a(t)},function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e=a(t),s=0;s<e.length;s++)"default"!==e[s]&&o(n,t,e[s]);return i(n,t),n}),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.ContributionVisualization=void 0;const l=s(e(398)),c=r(e(716));n.ContributionVisualization=class{constructor(t,n){this.context=t,this.disposables=[],this.analyzer=n}dispose(){this.panel?.dispose(),this.disposables.forEach((t=>t.dispose()))}onTimeRangeChange(t){this.timeRangeChangeCallback=t}async update(t){this.panel&&await this.updateVisualization(t)}async updateStats(t){if(!this.panel)return;const n=Object.values(t),e=this.getAllDates(t),a=this.prepareCommitData(n,e),o=this.prepareChangeData(n,e);this.panel?.webview&&this.panel.webview.postMessage({command:"updateData",commitData:a,changeData:o})}async updateVisualization(t){if(!this.panel)return;const n=Object.values(t),e=this.getAllDates(t),a=this.prepareCommitData(n,e),o=this.prepareChangeData(n,e),i=n.map((t=>({author:t.author,totalCommits:t.totalCommits||0,totalInsertions:t.totalInsertions||0,totalDeletions:t.totalDeletions||0,totalFiles:t.totalFiles||0})));this.panel&&await this.panel.webview.postMessage({command:"updateData",commitData:a,changeData:o,authorStats:i})}async handleTimeRangeChange(t,n,e){try{const a=await this.analyzer.getContributionStats(t,n,e);await this.update(a)}catch(t){}}async show(t){this.panel?this.panel.reveal():(this.panel=l.window.createWebviewPanel("codeActivityStats","Git Stats",l.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[this.context.extensionUri]}),this.panel.onDidDispose((()=>{this.panel=void 0}),null,this.disposables),this.panel.webview.onDidReceiveMessage((async t=>{if("timeRangeChanged"===t.command)await this.handleTimeRangeChange(t.days,t.startDate,t.endDate)}),void 0,this.disposables));const n=this.getAllDates(t),e=this.prepareCommitData(Object.values(t),n),a=this.prepareChangeData(Object.values(t),n);this.panel&&(this.panel.webview.html=this.getWebviewContent(t,e,a))}getWebviewContent(t,n,e){const a=Object.values(t),o=(this.getAllDates(t),(0,c.default)(a[0]?.endDate).format("YYYY-MM-DD")),i=(0,c.default)(a[0]?.endDate).subtract(6,"days").format("YYYY-MM-DD");return'<!DOCTYPE html>\n        <html>\n        <head>\n            <title>Git Stats</title>\n            <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"><\/script>\n            <style>\n                :root {\n                    --vscode-dropdown-background: var(--vscode-input-background);\n                    --vscode-dropdown-foreground: var(--vscode-input-foreground);\n                    --vscode-dropdown-border: var(--vscode-input-border);\n                }\n                .container {\n                    padding: 20px;\n                    max-width: 1200px;\n                    margin: 0 auto;\n                    font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, Oxygen, Ubuntu, Cantarell, \'Open Sans\', \'Helvetica Neue\', sans-serif;\n                }\n                .header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 20px;\n                }\n                .time-range-selector {\n                    display: flex;\n                    align-items: center;\n                    gap: 10px;\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                }\n                .date-picker {\n                    background-color: var(--vscode-dropdown-background);\n                    color: var(--vscode-dropdown-foreground);\n                    border: 1px solid var(--vscode-dropdown-border);\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                    font-size: 13px;\n                }\n                .date-separator {\n                    color: var(--vscode-foreground);\n                    margin: 0 4px;\n                }\n                .chart-container {\n                    position: relative;\n                    height: 400px;\n                    margin-bottom: 20px;\n                    background-color: var(--vscode-editor-background);\n                    padding: 15px;\n                    border-radius: 8px;\n                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                }\n                .chart-title {\n                    margin-bottom: 15px;\n                    color: var(--vscode-foreground);\n                    font-size: 18px;\n                    font-weight: 500;\n                }\n                .summary-table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-top: 20px;\n                    margin-bottom: 30px;\n                    background-color: var(--vscode-editor-background);\n                    border-radius: 8px;\n                    overflow: hidden;\n                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                }\n                .summary-table th, .summary-table td {\n                    padding: 12px;\n                    text-align: left;\n                    border: 1px solid var(--vscode-dropdown-border);\n                }\n                .summary-table th {\n                    background-color: var(--vscode-dropdown-background);\n                    font-weight: 500;\n                }\n                .summary-table tr:hover {\n                    background-color: var(--vscode-list-hoverBackground);\n                }\n                .pie-chart-container {\n                    position: absolute;\n                    top: 100px;\n                    left: 100px;\n                    width: 150px;\n                    height: 150px;\n                    background-color: rgba(255, 255, 255, 0.05);\n                    border-radius: 8px;\n                    cursor: move;\n                    z-index: 1000;\n                    backdrop-filter: blur(3px);\n                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);\n                }\n                .pie-chart-container:hover {\n                    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);\n                }\n                select {\n                    background-color: var(--vscode-dropdown-background);\n                    color: var(--vscode-dropdown-foreground);\n                    border: 1px solid var(--vscode-dropdown-border);\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                    font-size: 13px;\n                }\n                select:focus {\n                    outline: none;\n                    border-color: var(--vscode-focusBorder);\n                }\n                h1 {\n                    margin: 0;\n                    font-size: 24px;\n                    color: var(--vscode-foreground);\n                }\n            </style>\n        </head>\n        <body>\n            <div class="container">\n                <div class="header">\n                    <h1>Git Stats</h1>\n                    <div class="time-range-selector">\n                        <input type="date" id="startDate" class="date-picker" title="Start Date">\n                        <span class="date-separator">to</span>\n                        <input type="date" id="endDate" class="date-picker" title="End Date">\n                        <select id="timeRange">\n                            <option value="custom" selected>Custom Range</option>\n                            <option value="7">Last Week</option>\n                            <option value="30">Last Month</option>\n                            <option value="90">Last 3 Months</option>\n                            <option value="180">Last 6 Months</option>\n                            <option value="365">Last Year</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="chart-container">\n                    <div class="pie-chart-container">\n                        <canvas id="pieChart"></canvas>\n                    </div>\n                    <h2 class="chart-title">Commits</h2>\n                    <canvas id="commitChart"></canvas>\n                </div>\n                <div class="chart-container">\n                    <div class="pie-chart-container">\n                        <canvas id="linesChangedPieChart"></canvas>\n                    </div>\n                    <h2 class="chart-title">Lines Changed</h2>\n                    <canvas id="changeChart"></canvas>\n                </div>\n\n                <h2>Summary</h2>\n                <table class="summary-table">\n                    <tr>\n                        <th>Author</th>\n                        <th>Total Commits</th>\n                        <th>Lines Added</th>\n                        <th>Lines Deleted</th>\n                        <th>Files Changed</th>\n                    </tr>\n                    '+a.map((t=>"\n                        <tr>\n                            <td>"+t.author+"</td>\n                            <td>"+t.totalCommits+"</td>\n                            <td>"+t.totalInsertions+"</td>\n                            <td>"+t.totalDeletions+"</td>\n                            <td>"+t.totalFiles+"</td>\n                        </tr>\n                    ")).join("")+`\n                </table>\n            </div>\n            <script>\n                // 拖动功能\n                const pieChartContainers = document.querySelectorAll('.pie-chart-container');\n                let isDragging = false;\n                let currentX;\n                let currentY;\n                let initialX;\n                let initialY;\n                let activePieChart = null;\n\n                pieChartContainers.forEach(container => {\n                    container.addEventListener('mousedown', (e) => {\n                        activePieChart = container;\n                        dragStart(e);\n                    });\n                });\n                \n                document.addEventListener('mousemove', drag);\n                document.addEventListener('mouseup', dragEnd);\n\n                function dragStart(e) {\n                    if (!activePieChart) return;\n                    initialX = e.clientX - activePieChart.offsetLeft;\n                    initialY = e.clientY - activePieChart.offsetTop;\n                    isDragging = true;\n                }\n\n                function drag(e) {\n                    if (isDragging && activePieChart) {\n                        e.preventDefault();\n                        currentX = e.clientX - initialX;\n                        currentY = e.clientY - initialY;\n                        \n                        // 限制在图表区域内\n                        const container = activePieChart.closest('.chart-container');\n                        const maxX = container.offsetWidth - activePieChart.offsetWidth;\n                        const maxY = container.offsetHeight - activePieChart.offsetHeight;\n                        \n                        currentX = Math.max(0, Math.min(currentX, maxX));\n                        currentY = Math.max(0, Math.min(currentY, maxY));\n\n                        activePieChart.style.left = currentX + 'px';\n                        activePieChart.style.top = currentY + 'px';\n                    }\n                }\n\n                function dragEnd() {\n                    isDragging = false;\n                    activePieChart = null;\n                }\n\n                const vscode = acquireVsCodeApi();\n                let commitChart, changeChart, pieChart, linesChangedPieChart;\n\n                // 解析数据\n                const commitData = ${JSON.stringify(n)};\n                const changeData = ${JSON.stringify(e)};\n\n                // 设置初始日期范围\n                const today = new Date();\n                today.setHours(0, 0, 0, 0);  // 设置时间为当天的0点\n                const lastCommitDate = new Date('${o}');\n                lastCommitDate.setHours(0, 0, 0, 0);  // 设置时间为当天的0点\n\n                document.getElementById('startDate').value = '${i}';\n                document.getElementById('endDate').value = '${o}';\n                \n                // 如果最后一次提交是今天，则设置为"Last Week"\n                if (lastCommitDate.getTime() === today.getTime()) {\n                    document.getElementById('timeRange').value = '7';  // Last Week\n                } else {\n                    document.getElementById('timeRange').value = 'custom';  // Custom Range\n                }\n\n                // 创建提交图表\n                function createCommitChart(data) {\n                    const ctx = document.getElementById('commitChart');\n                    if (commitChart) {\n                        commitChart.destroy();\n                    }\n                    commitChart = new Chart(ctx, {\n                        type: 'line',\n                        data: data,\n                        options: {\n                            responsive: true,\n                            maintainAspectRatio: false,\n                            interaction: {\n                                intersect: false,\n                                mode: 'index'\n                            },\n                            plugins: {\n                                legend: {\n                                    position: 'top',\n                                },\n                                tooltip: {\n                                    callbacks: {\n                                        label: function(context) {\n                                            return context.dataset.label + ': ' + context.raw + ' commits';\n                                        }\n                                    }\n                                }\n                            },\n                            elements: {\n                                line: {\n                                    tension: 0.4,\n                                    cubicInterpolationMode: 'monotone'\n                                }\n                            },\n                            scales: {\n                                x: {\n                                    title: {\n                                        display: true,\n                                        text: 'Date'\n                                    },\n                                    ticks: {\n                                        maxRotation: 45,\n                                        minRotation: 45\n                                    }\n                                },\n                                y: {\n                                    beginAtZero: true,\n                                    title: {\n                                        display: true,\n                                        text: 'Number of Commits'\n                                    }\n                                }\n                            }\n                        }\n                    });\n                }\n\n                // 创建变更图表\n                function createChangeChart(data) {\n                    const ctx = document.getElementById('changeChart');\n                    if (changeChart) {\n                        changeChart.destroy();\n                    }\n                    changeChart = new Chart(ctx, {\n                        type: 'bar',\n                        data: data,\n                        options: {\n                            responsive: true,\n                            maintainAspectRatio: false,\n                            interaction: {\n                                intersect: false,\n                                mode: 'index'\n                            },\n                            plugins: {\n                                legend: {\n                                    position: 'top',\n                                },\n                                tooltip: {\n                                    callbacks: {\n                                        label: function(context) {\n                                            return context.dataset.label + ': ' + context.raw + ' lines changed';\n                                        }\n                                    }\n                                }\n                            },\n                            scales: {\n                                x: {\n                                    title: {\n                                        display: true,\n                                        text: 'Date'\n                                    },\n                                    ticks: {\n                                        maxRotation: 45,\n                                        minRotation: 45\n                                    }\n                                },\n                                y: {\n                                    beginAtZero: true,\n                                    title: {\n                                        display: true,\n                                        text: 'Lines Changed'\n                                    }\n                                }\n                            }\n                        }\n                    });\n                }\n\n                // 创建饼图\n                function createPieChart(data) {\n                    const ctx = document.getElementById('pieChart');\n                    const totalCommits = data.datasets.reduce((acc, dataset) => {\n                        return acc + dataset.data.reduce((sum, val) => sum + val, 0);\n                    }, 0);\n                    \n                    const pieData = {\n                        labels: data.datasets.map(d => d.label),\n                        datasets: [{\n                            data: data.datasets.map(d => \n                                d.data.reduce((sum, val) => sum + val, 0)\n                            ),\n                            backgroundColor: data.datasets.map(d => d.backgroundColor),\n                            borderColor: 'rgba(0, 0, 0, 0.1)',\n                            borderWidth: 1\n                        }]\n                    };\n\n                    if (pieChart) {\n                        pieChart.destroy();\n                    }\n\n                    pieChart = new Chart(ctx, {\n                        type: 'pie',\n                        data: pieData,\n                        options: {\n                            responsive: true,\n                            maintainAspectRatio: false,\n                            plugins: {\n                                legend: {\n                                    display: false\n                                },\n                                tooltip: {\n                                    callbacks: {\n                                        label: function(context) {\n                                            const value = context.raw;\n                                            const percentage = ((value / totalCommits) * 100).toFixed(1);\n                                            return [\n                                                context.label,\n                                                'Commits: ' + value,\n                                                'Percentage: ' + percentage + '%'\n                                            ];\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    });\n                }\n\n                // 创建Lines Changed饼图\n                function createLinesChangedPieChart(data) {\n                    const ctx = document.getElementById('linesChangedPieChart');\n                    const totalLines = data.datasets.reduce((acc, dataset) => {\n                        return acc + dataset.data.reduce((sum, val) => sum + val, 0);\n                    }, 0);\n                    \n                    const pieData = {\n                        labels: data.datasets.map(d => d.label),\n                        datasets: [{\n                            data: data.datasets.map(d => \n                                d.data.reduce((sum, val) => sum + val, 0)\n                            ),\n                            backgroundColor: data.datasets.map(d => d.backgroundColor),\n                            borderColor: 'rgba(0, 0, 0, 0.1)',\n                            borderWidth: 1\n                        }]\n                    };\n\n                    if (linesChangedPieChart) {\n                        linesChangedPieChart.destroy();\n                    }\n\n                    linesChangedPieChart = new Chart(ctx, {\n                        type: 'pie',\n                        data: pieData,\n                        options: {\n                            responsive: true,\n                            maintainAspectRatio: false,\n                            plugins: {\n                                legend: {\n                                    display: false\n                                },\n                                tooltip: {\n                                    callbacks: {\n                                        label: function(context) {\n                                            const value = context.raw;\n                                            const percentage = ((value / totalLines) * 100).toFixed(1);\n                                            return [\n                                                context.label,\n                                                'Lines Changed: ' + value,\n                                                'Percentage: ' + percentage + '%'\n                                            ];\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    });\n                }\n\n                // 初始化所有图表\n                createCommitChart(commitData);\n                createChangeChart(changeData);\n                createPieChart(commitData);\n                createLinesChangedPieChart(changeData);\n\n                // 监听来自 VS Code 的消息\n                window.addEventListener('message', event => {\n                    const message = event.data;\n                    switch (message.command) {\n                        case 'updateData':\n                            // 更新所有图表\n                            if (commitChart) {\n                                commitChart.data = message.commitData;\n                                commitChart.update();\n                                createPieChart(message.commitData);\n                            }\n                            if (changeChart) {\n                                changeChart.data = message.changeData;\n                                changeChart.update();\n                                createLinesChangedPieChart(message.changeData);\n                            }\n\n                            // 更新summary表格\n                            const summaryTable = document.querySelector('.summary-table');\n                            if (summaryTable && message.authorStats) {\n                                // 保留表头\n                                const tableHeader = summaryTable.querySelector('tr');\n                                if (tableHeader) {\n                                    summaryTable.innerHTML = '';\n                                    summaryTable.appendChild(tableHeader);\n\n                                    // 使用后端发送的准确统计数据\n                                    message.authorStats.forEach(authorStat => {\n                                        const row = document.createElement('tr');\n                                        const cells = [\n                                            authorStat.author,\n                                            authorStat.totalCommits || 0,\n                                            authorStat.totalInsertions || 0,\n                                            authorStat.totalDeletions || 0,\n                                            authorStat.totalFiles || 0\n                                        ];\n                                        cells.forEach(value => {\n                                            const cell = document.createElement('td');\n                                            cell.textContent = value.toString();\n                                            row.appendChild(cell);\n                                        });\n                                        summaryTable.appendChild(row);\n                                    });\n                                }\n                            }\n                            break;\n                    }\n                });\n\n                // 时间范围选择处理\n                const timeRangeSelect = document.getElementById('timeRange');\n                const startDateInput = document.getElementById('startDate');\n                const endDateInput = document.getElementById('endDate');\n\n                // 时间范围选择变化处理\n                timeRangeSelect.addEventListener('change', function(e) {\n                    const value = this.value;\n                    if (value === 'custom') {\n                        return; // 保持当前选择的日期不变\n                    }\n\n                    const days = parseInt(value);\n                    const end = new Date();\n                    const start = new Date();\n                    start.setDate(end.getDate() - (days - 1)); // -1是因为包含今天\n\n                    startDateInput.value = start.toISOString().split('T')[0];\n                    endDateInput.value = end.toISOString().split('T')[0];\n\n                    // 通知扩展时间范围已更改\n                    vscode.postMessage({\n                        command: 'timeRangeChanged',\n                        days: days,\n                        startDate: startDateInput.value,\n                        endDate: endDateInput.value\n                    });\n                });\n\n                // 日期选择变化处理\n                function handleDateChange() {\n                    const start = new Date(startDateInput.value);\n                    const end = new Date(endDateInput.value);\n                    \n                    if (start && end && start <= end) {\n                        // 计算天数差异\n                        const diffTime = Math.abs(end - start);\n                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 包含开始日期\n                        \n                        // 设置下拉框为custom\n                        timeRangeSelect.value = 'custom';\n                        \n                        // 通知扩展时间范围已更改\n                        vscode.postMessage({\n                            command: 'timeRangeChanged',\n                            days: diffDays,\n                            startDate: startDateInput.value,\n                            endDate: endDateInput.value\n                        });\n                    }\n                }\n\n                startDateInput.addEventListener('change', handleDateChange);\n                endDateInput.addEventListener('change', handleDateChange);\n            <\/script>\n        </body>\n        </html>`}getAllDates(t){const n=c.default.utc(Object.values(t)[0]?.startDate),e=c.default.utc(Object.values(t)[0]?.endDate),a=[];let o=n.clone();for(;o.isSameOrBefore(e);)a.push(o.format("YYYY-MM-DD")),o.add(1,"day");return a}prepareCommitData(t,n){const e=(t=t.filter((t=>!t.author.toLowerCase().includes("stash")))).map(((t,e)=>({label:t.author,data:n.map((n=>t.dailyStats[n]?.commits||0)),borderColor:this.getColor(e),backgroundColor:this.getColor(e),fill:!1,tension:.4,cubicInterpolationMode:"monotone"})));return{labels:n,datasets:e}}prepareChangeData(t,n){const e=(t=t.filter((t=>!t.author.toLowerCase().includes("stash")))).map(((t,e)=>({label:t.author,data:n.map((n=>{const e=t.dailyStats[n];return e?e.insertions+e.deletions:0})),backgroundColor:this.getColor(e),stack:"combined"})));return{labels:n,datasets:e}}getColor(t){const n=["#2196F3","#4CAF50","#F44336","#FFC107","#9C27B0","#00BCD4","#FF9800","#795548","#607D8B","#E91E63"];return n[t%n.length]}}},383:t=>{t.exports=require("fs")},716:t=>{t.exports=require("moment")},3:t=>{t.exports=require("path")},807:t=>{t.exports=require("simple-git")},398:t=>{t.exports=require("vscode")}},n={};var e=function e(a){var o=n[a];if(void 0!==o)return o.exports;var i=n[a]={exports:{}};return t[a].call(i.exports,i,i.exports,e),i.exports}(144);module.exports=e})();